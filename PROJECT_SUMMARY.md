# 프로젝트 재구성 완료 - Ver1 & Ver2

**작성일**: 2025-11-05  
**상태**: Ver1 완료 ✅, Ver2 시작 🚧

---

## 🎯 재구성 이유

### 발견한 중요한 사실

Ver1 모델은 **횡단면 분석(Cross-sectional)**으로 설계되어 있었습니다:

```
❌ 기존 설명 (잘못됨):
"식습관을 이렇게 바꾸면 3개월 후 체중이 5kg 감소합니다"

✅ 실제 의미 (올바름):
"이런 식습관을 가진 사람들의 평균 체중은 82kg입니다"
```

### 핵심 차이

| 항목 | Ver1 실제 | 사용자가 원하는 것 |
|------|-----------|-------------------|
| **예측** | 현재 상태 추정 | 미래 변화 예측 |
| **관계** | 상관관계 | 인과관계 |
| **질문** | "이런 사람의 건강은?" | "바꾸면 어떻게 될까?" |
| **데이터** | 독립 샘플 | 방문 쌍 (Before-After) |

---

## 📁 새로운 프로젝트 구조

```
HPEACE_prediction/
│
├── ver1/  ✅ 완료
│   ├── src/
│   │   └── TABNET_ENHANCED_MODEL.py    # TabNet + Stacking
│   ├── run_training.py                  # 실행 스크립트
│   └── README.md                        # Ver1 설명
│
├── ver2/  🚧 개발 중
│   ├── data_preprocessing.py            # ✅ 완료
│   ├── model_training.py                # ⏳ 예정
│   └── README.md                        # Ver2 계획
│
├── data/
│   ├── total_again.xlsx                 # 원본 데이터
│   └── ver2_paired_visits.csv           # ⏳ 생성 예정
│
├── result/
│   ├── ver1/                            # Ver1 결과
│   └── ver2_eda/                        # ⏳ Ver2 EDA
│
└── docs/
    ├── ANALYSIS_REPORT.md               # Ver1 분석 보고서
    └── INPUT_OUTPUT_EXPLANATION.md      # Ver1 입출력 설명
```

---

## 🔄 Ver1: Cross-sectional Analysis

### 완성된 것

✅ **모델**: TabNet + Stacking Ensemble  
✅ **성능**: 평균 R² = 0.8992 (89.92%)  
✅ **문서**: 완벽한 분석 보고서 (16KB)  
✅ **사용**: 즉시 활용 가능

### 예측 내용

"**특정 식습관 패턴을 가진 사람들의 평균적인 건강지표**"

#### 데이터 구조
```python
# 각 행 = 독립적인 1번 방문
Row 1: [사람A_2023-03] 고지방5, 채소2 → 체중87kg
Row 2: [사람A_2023-09] 고지방2, 채소5 → 체중82kg  # 독립 샘플
Row 3: [사람B_2023-01] 고지방3, 채소4 → 체중65kg

→ 3개 독립 샘플로 학습
→ 방문 간 연결 없음
```

#### 예측 예시
```python
입력: {고지방: 5, 채소: 2, 야식: 4, ...}
출력: {체중: 87kg, BMI: 28.2, SBP: 148mmHg}

해석: "이런 식습관을 가진 사람들은 평균적으로
       체중 87kg, BMI 28.2를 가집니다"
```

### 한계점

❌ **인과관계 불명확**
- "식습관을 바꾸면 건강이 개선된다" 입증 불가
- "건강한 식습관 ↔ 좋은 건강"의 연관성만 확인

❌ **개인 맞춤 변화 예측 불가**
- 개인의 변화 예측 불가능
- Population-level만 가능

❌ **시간 개념 없음**
- 3개월 후, 6개월 후 예측 불가능
- 현재 상태 추정만 가능

### 실용성

✅ **건강 스크리닝**
- "현재 식습관으로 건강 상태 추정"
- 위험군 식별

✅ **패턴 분석**
- "어떤 식습관이 건강과 연관되는가"
- 정책 수립 기초 자료

---

## 🆕 Ver2: Longitudinal Change Prediction

### 개발 목표

"**식습관 변화가 건강지표 변화에 미치는 영향**" 예측

### 새로운 데이터 구조

```python
# Paired visits (방문 쌍)
Pair 1: [사람A] 2023-03 → 2023-09 (180일)
  입력: {
    '고지방_변화': 5→2 (-3점),
    '채소_변화': 2→5 (+3점),
    '야식_변화': 4→1 (-3점),
    '시간차': 180일,
    '베이스라인_체중': 87kg
  }
  출력: {
    '체중_변화': -5kg,
    'BMI_변화': -1.8,
    'SBP_변화': -16mmHg
  }

→ 1개 방문 쌍 = 1개 샘플
→ 변화 패턴 학습
```

### 예측 예시

```python
# 현재 상태
현재_식습관 = {고지방: 5, 채소: 2, 야식: 4}
현재_건강 = {체중: 87kg, BMI: 28.2, SBP: 148mmHg}

# 계획된 변화
계획 = {
  고지방: 5→2,
  채소: 2→5,
  야식: 4→1,
  기간: 90일 (3개월)
}

# Ver2 예측
예상_변화 = model.predict(계획)
→ {
  체중_변화: -5.2kg,
  BMI_변화: -1.7,
  SBP_변화: -15mmHg
}

# 3개월 후 예상
예상_건강 = {
  체중: 87 - 5.2 = 81.8kg,
  BMI: 28.2 - 1.7 = 26.5,
  SBP: 148 - 15 = 133mmHg
}
```

### 기대 효과

✅ **인과관계 파악**
- 식습관 개선 → 건강 개선 직접 입증
- 개입 효과 정량화

✅ **개인 맞춤 예측**
- "당신이 이렇게 바꾸면 이렇게 됩니다"
- Individual-level prediction

✅ **시간 개념 포함**
- 3개월 후, 6개월 후 예측 가능
- 변화 속도 고려

✅ **역방향 추론**
- "체중 5kg 감량하려면 어떻게?"
- 목표 기반 식습관 계획

### 개발 현황

#### ✅ 완료
```
1. 데이터 전처리 스크립트 (data_preprocessing.py)
   - Paired visits 생성
   - 변화량 계산
   - 파생 특성 생성
   - EDA 및 시각화
```

#### ⏳ 진행 예정
```
2. 모델 개발
   - Option 1: LSTM (시계열)
   - Option 2: Temporal Fusion Transformer
   - Option 3: XGBoost for Change

3. 학습 및 평가
   - Cross-validation
   - 성능 평가 (R², MAE, Direction Accuracy)
   - 특성 중요도 분석

4. 문서화
   - Ver2 분석 보고서
   - 사용자 가이드
   - Ver1 vs Ver2 비교
```

---

## 📊 Ver1 vs Ver2 비교

### 데이터

| 항목 | Ver1 | Ver2 |
|------|------|------|
| 샘플 수 | 29,098개 | ~18,000개 (예상) |
| 1개 샘플 | 1번 방문 | 2번 방문 쌍 |
| 독립성 | 독립 샘플 | 같은 사람 연결 |
| 시간 | 1개 시점 | 2개 시점 + 간격 |

### 입력/출력

| 항목 | Ver1 | Ver2 |
|------|------|------|
| 입력 | 식습관 19개 | 식습관 변화 19개 + 시간 + 베이스라인 |
| 출력 | 건강지표 6개 | 건강지표 **변화량** 6개 |
| 예측 | 절대값 | 변화량 |

### 예측 성능 (예상)

| 지표 | Ver1 | Ver2 (목표) |
|------|------|-------------|
| 체중 | R² = 0.999 | R² > 0.70 |
| BMI | R² = 0.999 | R² > 0.70 |
| 혈압 | R² = 0.81 | R² > 0.50 |

> 💡 **주의**: Ver2의 R²가 낮은 것은 당연합니다!
> - Ver1: 전체 변동 설명
> - Ver2: 변화량만 설명 (더 어려운 문제)

### 실용성

| 용도 | Ver1 | Ver2 |
|------|------|------|
| 스크리닝 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 위험군 식별 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 개입 효과 | ⭐⭐ | ⭐⭐⭐⭐⭐ |
| 맞춤 계획 | ⭐⭐ | ⭐⭐⭐⭐⭐ |
| 진행 모니터링 | ⭐⭐ | ⭐⭐⭐⭐⭐ |

---

## 🎯 Ver2 개발 로드맵

### Phase 1: 데이터 준비 (Week 1-2) ✅ 진행 가능

```bash
# Windows에서 실행
cd ver2
python data_preprocessing.py

# 예상 출력
✅ Paired visits: ~18,000개 생성
✅ EDA 그래프: result/ver2_eda/
✅ 처리된 데이터: data/ver2_paired_visits.csv
```

### Phase 2: 모델 개발 (Week 3-4) ⏳ 계획 중

```python
# 3가지 모델 비교

1. XGBoost (Baseline)
   - 빠르고 안정적
   - 변화량을 직접 학습
   
2. LSTM
   - 시계열 패턴 포착
   - 장기 의존성 학습
   
3. Temporal Fusion Transformer
   - SOTA 시계열 모델
   - Attention + 해석 가능성
```

### Phase 3: 평가 (Week 5-6) ⏳ 계획 중

```python
평가 지표:
- Change R²: 변화 예측 정확도
- MAE: 평균 절대 오차
- Direction Accuracy: 방향 정확도 (증가/감소/유지)
- MAPE: 평균 절대 백분율 오차
```

### Phase 4: 문서화 (Week 7-8) ⏳ 계획 중

```
- Ver2 분석 보고서
- Ver1 vs Ver2 비교 분석
- 사용자 가이드
- API 문서 (선택)
```

---

## 💡 주요 인사이트

### 1. Ver1의 가치는 여전히 높음

```
✅ 우수한 성능 (R² 0.90)
✅ 완벽한 문서화
✅ 즉시 사용 가능
✅ 스크리닝 용도로 최적

→ Ver1은 그대로 유지하고 활용
```

### 2. Ver2는 다른 질문에 답함

```
Ver1: "현재 어떤 상태인가?"
Ver2: "어떻게 개선할 수 있나?"

→ 상호 보완적 관계
→ 함께 사용하면 완벽한 솔루션
```

### 3. 실제 활용 시나리오

```
Step 1 (Ver1): 현재 건강 상태 평가
  입력: 현재 식습관
  출력: 예상 건강지표
  → "당신의 현재 상태는 이렇습니다"

Step 2 (Ver2): 개선 계획 수립
  입력: 식습관 변화 계획
  출력: 예상 건강 개선
  → "이렇게 바꾸면 3개월 후 이렇게 됩니다"

Step 3 (Ver2): 진행 모니터링
  입력: 실제 변화 데이터
  출력: 예상 vs 실제 비교
  → "계획대로 진행 중입니다"
```

---

## 📞 다음 단계

### Windows에서 Ver2 시작하기

```bash
# 1. 최신 코드 받기
git pull origin main

# 2. Ver2 폴더로 이동
cd ver2

# 3. 데이터 전처리 실행
python data_preprocessing.py

# 예상 소요 시간: 5-10분
# 결과: data/ver2_paired_visits.csv 생성
```

### 확인 사항

```bash
# 생성된 파일 확인
dir ..\data\ver2_paired_visits.csv

# EDA 결과 확인
dir ..\result\ver2_eda\*.png

# 요약 통계 확인
type ..\data\ver2_paired_visits_summary.txt
```

---

## 📚 참고 문서

### Ver1 관련
- `/ver1/README.md` - Ver1 상세 설명
- `/docs/ANALYSIS_REPORT.md` - 완벽한 분석 보고서
- `/docs/INPUT_OUTPUT_EXPLANATION.md` - 입출력 설명

### Ver2 관련
- `/ver2/README.md` - Ver2 개발 계획
- `/ver2/data_preprocessing.py` - 데이터 전처리 스크립트

### 비교
- `/README.md` - 프로젝트 전체 개요 (Ver1 vs Ver2)
- `PROJECT_SUMMARY.md` - 이 문서

---

## 🎉 결론

Ver1과 Ver2는 서로 다른 **연구 질문**에 답하는 **상호 보완적** 모델입니다.

```
Ver1: "What is?"    (현재 상태 파악)
Ver2: "What if?"    (변화 예측)

→ 함께 사용하면 완벽한 건강관리 시스템!
```

**Ver1은 이미 완성**되었고, **Ver2 개발 준비 완료**!

데이터 전처리 스크립트가 준비되었으니, 언제든지 Ver2 개발을 시작할 수 있습니다! 🚀

---

**작성자**: AI Research Team  
**작성일**: 2025-11-05  
**버전**: 1.0  
**상태**: Ver1 ✅ Complete, Ver2 🚧 Ready to Start

© 2025 HPEACE Prediction Project
