# ğŸš¨ Data Leakage ë¬¸ì œ ìˆ˜ì •

## ğŸ“‹ ë¬¸ì œ ë°œê²¬ (2025-11-06)

### ğŸ”´ ì‹¬ê°í•œ Data Leakage ë°œê²¬

**ì¦ìƒ**: ëª¨ë“  ëª¨ë¸ì—ì„œ RÂ² > 0.98 (ë¹„ì •ìƒì ìœ¼ë¡œ ë†’ì€ ì„±ëŠ¥)

**ì›ì¸**: íƒ€ê²Ÿ ë³€ìˆ˜ì™€ ìˆ˜í•™ì ìœ¼ë¡œ ì§ì ‘ ì—°ê²°ëœ baseline íŠ¹ì„± ì‚¬ìš©

## ğŸ” ë¬¸ì œ ìƒì„¸ ë¶„ì„

### ì´ì „ ì½”ë“œ (Leakage ìˆìŒ)

```python
# Input Features (X):
additional_features = ['time_gap_days', f'{self.target_variable}_baseline']
# ì˜ˆ: ì²´ì¤‘_baseline

# Target (y):
target_col = f'{self.target_variable}_change'
# ì˜ˆ: ì²´ì¤‘_change = ì²´ì¤‘_final - ì²´ì¤‘_baseline
```

### ì™œ ë¬¸ì œì¸ê°€?

**ìˆ˜í•™ì  ê´€ê³„**:
```
ì²´ì¤‘_change = ì²´ì¤‘_final - ì²´ì¤‘_baseline
â†’ ì²´ì¤‘_final = ì²´ì¤‘_baseline + ì²´ì¤‘_change
```

**ëª¨ë¸ì´ í•™ìŠµí•œ ê²ƒ**:
- ì¸ê³¼ê´€ê³„: "ì‹ìŠµê´€ ë³€í™” â†’ ê±´ê°• ë³€í™”" âŒ
- ìˆ˜í•™ ê´€ê³„: "baseline + change = final" âœ…

**ê²°ê³¼**:
- ëª¨ë¸ì´ baselineë§Œ ë³´ê³ ë„ changeë¥¼ ê±°ì˜ ì™„ë²½í•˜ê²Œ "ê³„ì‚°"
- ì‹ìŠµê´€ ë³€í™”ì˜ ì‹¤ì œ ì˜í–¥ë ¥ì„ ì¸¡ì •í•˜ì§€ ëª»í•¨
- ë†’ì€ RÂ²ì€ ê°€ì§œ ì„±ëŠ¥

## âœ… ìˆ˜ì • ë‚´ìš©

### ìˆ˜ì •ëœ ì½”ë“œ (Leakage ì œê±°)

```python
# Input Features (X):
# ì‹ìŠµê´€ ë³€í™”ë§Œ ì‚¬ìš© (ê±´ê°•ì§€í‘œ baseline ì™„ì „ ì œê±°)
diet_change_cols = [col for col in df.columns 
                   if '_change' in col and 'ê±´ê°•' not in col 
                   and not any(bio in col for bio in ['ì²´ì¤‘', 'ì²´ì§ˆëŸ‰ì§€ìˆ˜', 'í—ˆë¦¬ë‘˜ë ˆ', 'SBP', 'DBP', 'TG'])]

additional_features = ['time_gap_days']  # baseline ì œê±°!

# Target (y):
target_col = f'{self.target_variable}_change'
```

### ìˆ˜ì •ëœ íŒŒì¼ë“¤

1. âœ… `ver2/src/tabnet_model.py` - `prepare_data()` ë©”ì„œë“œ
2. âœ… `ver2/src/xgboost_model.py` - `prepare_data()` ë©”ì„œë“œ  
3. âœ… `ver2/src/lstm_model.py` - `prepare_data()` ë©”ì„œë“œ

## ğŸ“Š ì˜ˆìƒ ì„±ëŠ¥ ë³€í™”

| ìƒí™© | RÂ² ë²”ìœ„ | í•´ì„ |
|------|---------|------|
| **ì´ì „ (Leakage)** | 0.98-0.99 | ê°€ì§œ ì„±ëŠ¥ (ìˆ˜í•™ì  ê´€ê³„) |
| **ìˆ˜ì • í›„** | 0.3-0.7 | ì§„ì§œ ì„±ëŠ¥ (ì¸ê³¼ê´€ê³„) |

### í˜„ì‹¤ì ì¸ ëª©í‘œ

```
ì²´ì¤‘ ë³€í™” ì˜ˆì¸¡:
- RÂ² = 0.4-0.6 (ì¶©ë¶„íˆ ì˜ë¯¸ìˆìŒ)
- MAE < 2kg
- Direction Accuracy > 75%

í˜ˆì•• ë³€í™” ì˜ˆì¸¡:
- RÂ² = 0.3-0.5 
- MAE < 5mmHg
- Direction Accuracy > 70%
```

## ğŸ¯ ì˜¬ë°”ë¥¸ í•´ì„

### RÂ² = 0.50ì˜ ì˜ë¯¸

**ì˜ëª»ëœ í•´ì„**: "ëª¨ë¸ ì„±ëŠ¥ì´ ë‚˜ì˜ë‹¤"  
**ì˜¬ë°”ë¥¸ í•´ì„**: "ì‹ìŠµê´€ ë³€í™”ê°€ ê±´ê°• ë³€í™”ì˜ 50%ë¥¼ ì„¤ëª…í•œë‹¤"

**ì´ìœ **:
- ê±´ê°• ë³€í™”ëŠ” ë‹¤ì–‘í•œ ìš”ì¸ì˜ ì˜í–¥ì„ ë°›ìŒ:
  - ì‹ìŠµê´€ ë³€í™” (ìš°ë¦¬ê°€ ì¸¡ì •í•˜ëŠ” ê²ƒ)
  - ìš´ë™ëŸ‰ ë³€í™”
  - ìŠ¤íŠ¸ë ˆìŠ¤
  - ìˆ˜ë©´
  - ìœ ì „ì  ìš”ì¸
  - ë‚˜ì´
  - ì•½ë¬¼
  - ê¸°íƒ€ ìƒí™œìŠµê´€

**ê²°ë¡ **: RÂ² = 0.50ì´ë©´ ì‹ìŠµê´€ì˜ ì˜í–¥ë ¥ì´ **ë§¤ìš° í¬ë‹¤**ëŠ” ì˜ë¯¸!

## ğŸ”¬ ì¶”ê°€ ê³ ë ¤ì‚¬í•­

### 1. ì‹œê°„ ìˆœì„œ (Temporal Ordering)

**í˜„ì¬**: ë°©ë¬¸1 â†’ ë°©ë¬¸2 (ì˜¬ë°”ë¦„)  
**í™•ì¸ í•„ìš”**: ë°ì´í„° ëˆ„ìˆ˜ ì—†ì´ ì‹œê°„ ìˆœì„œ ë³´ì¥

### 2. Train/Val/Test Split

**í˜„ì¬**: Random split  
**ê¶Œì¥**: 
- ê°™ì€ ì‚¬ëŒì˜ ì—¬ëŸ¬ ìŒì´ ë‹¤ë¥¸ setì— ë¶„ì‚°ë˜ì§€ ì•Šë„ë¡
- Person-level split ê³ ë ¤

### 3. Feature Engineering

**ì œê±°ëœ ê²ƒ**: 
- `{target}_baseline` (ëª¨ë“  ê±´ê°•ì§€í‘œ)

**ìœ ì§€ë˜ëŠ” ê²ƒ**:
- ì‹ìŠµê´€ ë³€í™”ë“¤ (ì •ë‹¹í•¨)
- `time_gap_days` (ì •ë‹¹í•¨)

## ğŸ“ˆ ì¬í•™ìŠµ í•„ìš”

### ì‹¤í–‰ ë°©ë²•

```bash
cd "G:\ë‚´ ë“œë¼ì´ë¸Œ\#ì¸ë ¥ì–‘ì„±\3. ì‹ì´_SNUH\#Prediction"

# ìµœì‹  ì½”ë“œ ë°›ê¸°
git pull origin main

# ê¸°ì¡´ ê²°ê³¼ ë°±ì—…
move ver2\result ver2\result_with_leakage

# ì¬í•™ìŠµ
python ver2\run_ver2.py
```

### ì˜ˆìƒ ì†Œìš” ì‹œê°„

- TabNet: ~20ë¶„
- XGBoost: ~5ë¶„
- LSTM: ~15ë¶„
- **ì´**: ~40ë¶„

## ğŸ“ êµí›ˆ

### 1. í•­ìƒ ì˜ì‹¬í•˜ê¸°
- RÂ² > 0.95ëŠ” ì˜ì‹¬í•´ì•¼ í•¨
- "ë„ˆë¬´ ì¢‹ìœ¼ë©´ ë­”ê°€ ì˜ëª»ëœ ê²ƒ"

### 2. Feature ê²€ì¦
- íƒ€ê²Ÿê³¼ ìˆ˜í•™ì  ê´€ê³„ê°€ ìˆëŠ” featureëŠ” ì œê±°
- ì‹œê°„ì  ìˆœì„œ í™•ì¸ (ë¯¸ë˜ ì •ë³´ ì‚¬ìš© ê¸ˆì§€)

### 3. Domain Knowledge
- ì˜í•™/ê±´ê°• ë¶„ì•¼: RÂ² = 0.4-0.6ì´ë©´ ìš°ìˆ˜
- ë‹¨ìˆœ ì˜ˆì¸¡ ë¬¸ì œê°€ ì•„ë‹Œ ì¸ê³¼ê´€ê³„ ë¶„ì„

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

ì¬í•™ìŠµ ì „ í™•ì¸ì‚¬í•­:

- [x] 3ê°œ ëª¨ë¸ íŒŒì¼ ëª¨ë‘ ìˆ˜ì • ì™„ë£Œ
- [x] Baseline íŠ¹ì„± ì™„ì „íˆ ì œê±°
- [x] ì‹ìŠµê´€ ë³€í™”ë§Œ ì‚¬ìš©
- [x] ì½”ë“œ GitHub ì—…ë¡œë“œ
- [ ] ì¬í•™ìŠµ ì‹¤í–‰
- [ ] ì„±ëŠ¥ ì¬í‰ê°€
- [ ] ê²°ê³¼ í•´ì„ (ë‚®ì•„ì§„ RÂ²ëŠ” ì •ìƒ)

## ğŸ“š ì°¸ê³  ìë£Œ

### Data Leakage ê´€ë ¨
- Kaufman et al. (2012) "Leakage in Data Mining"
- Kaggle Learn: "Data Leakage"

### ì˜ë£Œ ë°ì´í„° ëª¨ë¸ë§
- ì¼ë°˜ì ìœ¼ë¡œ RÂ² = 0.3-0.6ì´ë©´ ìš°ìˆ˜í•œ ê²°ê³¼
- ë³€í™” ì˜ˆì¸¡ì€ ìƒíƒœ ì˜ˆì¸¡ë³´ë‹¤ ì–´ë ¤ì›€ (ì •ìƒ)

---

**ìˆ˜ì • ë‚ ì§œ**: 2025-11-06  
**ìˆ˜ì •ì**: AI Assistant  
**ì‹¬ê°ë„**: ğŸ”´ Critical  
**ìƒíƒœ**: âœ… Fixed (ì¬í•™ìŠµ í•„ìš”)
